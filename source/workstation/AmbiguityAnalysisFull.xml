<?xml version="1.0" encoding="utf-8"?>
<AnalysisDefinition>
  <Name>EventAndEye</Name>
  <Period>
    <Name>TestPeriod</Name>
    <StartTrigger>start</StartTrigger>
    <Script>
      for(i=0;i&lt;eye.length;i++)
      {
      eyeFile.writeLine(&quot;&quot;+(Number(periodNumber)+1)
                        +&quot;,&quot;+eye.trialInSeq.value(eye.length-1)
                        +&quot;,&quot;+String( Math.round( 1000*(Number(eye.time.value(i))-Number(startTime)) ))
                        +&quot;,&quot;+Math.round(eye.data.value(0,i))
                        +&quot;,&quot;+Math.round(eye.data.value(1,i))
      );
      if(correct.length)
      eyeFileCorrect.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+eye.trialInSeq.value(eye.length-1)
      +&quot;,&quot;+String( Math.round( 1000*(Number(eye.time.value(i))-Number(startTime)) ))
      +&quot;,&quot;+Math.round(eye.data.value(0,i))
      +&quot;,&quot;+Math.round(eye.data.value(1,i))
      );
      }
      for(i=0;i&lt;diam.length;i++)
      {
      diamFile.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+diam.trialInSeq.value(diam.length-1)
      +&quot;,&quot;+String( Math.round( 1000*(Number(diam.time.value(i))-Number(startTime)) ))
      +&quot;,&quot;+Math.round(diam.data.value(0,i))
      +&quot;,&quot;+Math.round(diam.data.value(1,i))
      );
      if(correct.length)
      diamFileCorrect.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+diam.trialInSeq.value(diam.length-1)
      +&quot;,&quot;+String( Math.round( 1000*(Number(diam.time.value(i))-Number(startTime)) ))
      +&quot;,&quot;+Math.round(diam.data.value(0,i))
      +&quot;,&quot;+Math.round(diam.data.value(1,i))
      );
      }
      for(i=0;i&lt;Event.length;i++)
      {
      eventFile.writeLine(Event.data.value(i)+&quot;,&quot;+String(Math.round(1000*(Number(Event.time.value(i))-(Number(startTime))))));
      if(correct.length)
      eventFileCorrect.writeLine(Event.data.value(i)+&quot;,&quot;+String(Math.round(1000*(Number(Event.time.value(i))-(Number(startTime))))));
      }
      for(i=0;i&lt;Blob.length;i++)
      {
      blobFile.writeLine(Blob.data.value(i));
      if(correct.length)
      blobFileCorrect.writeLine(Blob.data.value(i));
      }
    </Script>
    <Trigger type="Element">
      <Name>start</Name>
      <When>Starts</When>
      <ElementPath>ProbabilityTracking::Top::Superblock::Block::Trial</ElementPath>
    </Trigger>
    <Trigger type="Element">
      <Name>correct</Name>
      <When>Starts</When>
      <ElementPath>ProbabilityTracking::Top::Superblock::Block::NeedsMoreTrials</ElementPath>
    </Trigger>
    <Trigger type="Property">
      <Name>Event</Name>
      <PropertyPath>ProbabilityTracking::Top::EventInfo::Values</PropertyPath>
      <DataSource type="Property">
        <Name>data</Name>
        <PropertyPath>ProbabilityTracking::Top::EventInfo::Values</PropertyPath>
      </DataSource>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>
    <Trigger type="Element">
      <Name>Blob</Name>
      <When>Ends</When>
      <ElementPath>ProbabilityTracking::Top::Superblock::Block::Trial</ElementPath>
      <DataSource type="Property">
        <Name>data</Name>
        <PropertyPath>ProbabilityTracking::Top::TrialInfo::Values</PropertyPath>
      </DataSource>
    </Trigger>
    <Trigger type="Signal">
      <Name>eye</Name>
      <SignalName>Position</SignalName>
      <DataSource type="Signal">
        <Name>data</Name>
        <SignalName>Position</SignalName>
      </DataSource>
      <DataSource type="Property">
        <Name>trialInSeq</Name>
        <PropertyPath>ProbabilityTracking::Top::Superblock::Block::TrialsSoFar::Value</PropertyPath>
      </DataSource>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>
    <Trigger type="Signal">
      <Name>diam</Name>
      <SignalName>Position</SignalName>
      <DataSource type="Signal">
        <Name>data</Name>
        <SignalName>Diameter</SignalName>
      </DataSource>
      <DataSource type="Property">
        <Name>trialInSeq</Name>
        <PropertyPath>ProbabilityTracking::Top::Superblock::Block::TrialsSoFar::Value</PropertyPath>
      </DataSource>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>
    <Output type="File">
      <Name>blobFile</Name>
      <FileName>untitled.blob.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>eventFile</Name>
      <FileName>untitled.event.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>eyeFile</Name>
      <FileName>untitled.eye.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>diamFile</Name>
      <FileName>untitled.joy.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>blobFileCorrect</Name>
      <FileName>untitled.blob.correct.txt</FileName>
    </Output>
    <Output type="File">
      <Name>eventFileCorrect</Name>
      <FileName>untitled.event.correct.txt</FileName>
    </Output>
    <Output type="File">
      <Name>eyeFileCorrect</Name>
      <FileName>untitled.eye.correct.txt</FileName>
    </Output>
    <Output type="File">
      <Name>diamFileCorrect</Name>
      <FileName>untitled.joy.correct.txt</FileName>
    </Output>
  </Period>
  <Period>
    <Name>TestPeriod</Name>
    <StartTrigger>start</StartTrigger>
    <StartBufferMs>1000</StartBufferMs>
    <EndBufferMs>1000</EndBufferMs>
    <Script>
      wasCorrect = false;
      for(i=0;i&lt;correct.length;i++)
      {
      if(correct.time.value(i)>Number(startTime))
        wasCorrect = true;
      }

      for(i=0;i&lt;spike.length;i++)
      {
       spikeFile.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+spike.trialInSeq.value(spike.length-1)
      +&quot;,&quot;+Math.round(1000*(spike.time.value(i)-Number(startTime)))
      +&quot;,&quot;+spike.data.channel(i)
      +&quot;,&quot;+spike.data.unit(i)
      +&quot;,&quot;+"-1000"
       +&quot;,&quot;+Math.round(1000*(Number(endTime)-Number(startTime)))
      );
      waveFile.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+spike.trialInSeq.value(spike.length-1)
      +&quot;,&quot;+spike.data.channel(i)
      +&quot;,&quot;+spike.data.unit(i)
      +&quot;,&quot;+Math.round(1000*(spike.time.value(i)-Number(startTime)))
      +&quot;,&quot;+Math.round(1000000000*spike.data.samplePeriod(i))/1000000
      +&quot;,&quot;+spike.data.waveSize(i)
      +&quot;,&quot;+spike.data.wave(i)
      );

      if(wasCorrect)
      {
      spikeFileCorrect.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+spike.trialInSeq.value(spike.length-1)
      +&quot;,&quot;+Math.round(1000*(spike.time.value(i)-Number(startTime)))
      +&quot;,&quot;+spike.data.channel(i)
      +&quot;,&quot;+spike.data.unit(i)
      +&quot;,&quot;+"-1000"
      +&quot;,&quot;+Math.round(1000*(Number(endTime)-Number(startTime)))
      );
      waveFileCorrect.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      +&quot;,&quot;+spike.trialInSeq.value(spike.length-1)
      +&quot;,&quot;+spike.data.channel(i)
      +&quot;,&quot;+spike.data.unit(i)
      +&quot;,&quot;+Math.round(1000*(spike.time.value(i)-Number(startTime)))
      +&quot;,&quot;+Math.round(1000000000*spike.data.samplePeriod(i))/1000000
      +&quot;,&quot;+spike.data.waveSize(i)
      +&quot;,&quot;+spike.data.wave(i)
      );
      }
      }

      //for(i=0;i&lt;lfp.length;i++)
      //{
      //lfpFile.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      //+&quot;,&quot;+lfp.trialInSeq.value(lfp.length-1)
      //+&quot;,&quot;+lfp.data.channel(i)
      //+&quot;,&quot;+Math.round(1000*(lfp.time.value(i)-Number(startTime)))
      //+&quot;,&quot;+lfp.data.value(i)
      //);
      //if(wasCorrect)
      //{
      //lfpFileCorrect.writeLine(&quot;&quot;+(Number(periodNumber)+1)
      //+&quot;,&quot;+lfp.trialInSeq.value(lfp.length-1)
      //+&quot;,&quot;+lfp.data.channel(i)
      //+&quot;,&quot;+Math.round(1000*(lfp.time.value(i)-Number(startTime)))
      //+&quot;,&quot;+lfp.data.value(i)
      //);
      //}
      //}

    </Script>
    <Trigger type="Element">
      <Name>start</Name>
      <When>Starts</When>
      <ElementPath>ProbabilityTracking::Top::Superblock::Block::Trial</ElementPath>
    </Trigger>
    <Trigger type="Spike">
      <Name>spike</Name>
      <DataSource type="Spike">
        <Name>data</Name>
        <ScaleFactor>1000</ScaleFactor>
        <DecimalPlaces>6</DecimalPlaces>
      </DataSource>
      <DataSource type="Property">
        <Name>trialInSeq</Name>
        <PropertyPath>ProbabilityTracking::Top::Superblock::Block::TrialsSoFar::Value</PropertyPath>
      </DataSource>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>
    <Trigger type="Element">
      <Name>correct</Name>
      <When>Starts</When>
      <ElementPath>ProbabilityTracking::Top::Superblock::Block::NeedsMoreTrials</ElementPath>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>
    <!--<Trigger type="LFP">
      <Name>lfp</Name>
      <DataSource type="LFP">
        <Name>data</Name>
      </DataSource>
      <DataSource type="Property">
        <Name>trialInSeq</Name>
        <PropertyPath>ProbabilityTracking::Top::Superblock::Block::TrialsSoFar::Value</PropertyPath>
      </DataSource>
      <DataSource type="Time">
        <Name>time</Name>
      </DataSource>
    </Trigger>-->
    <Output type="File">
      <Name>spikeFile</Name>
      <FileName>untitled.spikes.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>waveFile</Name>
      <FileName>untitled.wave.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>lfpFile</Name>
      <FileName>untitled.lfp.all.txt</FileName>
    </Output>
    <Output type="File">
      <Name>spikeFileCorrect</Name>
      <FileName>untitled.spikes.correct.txt</FileName>
    </Output>
    <Output type="File">
      <Name>waveFileCorrect</Name>
      <FileName>untitled.wave.correct.txt</FileName>
    </Output>
    <Output type="File">
      <Name>lfpFileCorrect</Name>
      <FileName>untitled.lfp.correct.txt</FileName>
    </Output>
  </Period>
</AnalysisDefinition>