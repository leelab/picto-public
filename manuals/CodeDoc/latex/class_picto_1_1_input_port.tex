\hypertarget{class_picto_1_1_input_port}{\section{Picto\-:\-:Input\-Port Class Reference}
\label{class_picto_1_1_input_port}\index{Picto\-::\-Input\-Port@{Picto\-::\-Input\-Port}}
}


Used to collect data from a single port that may handle multiple signals.  




{\ttfamily \#include $<$Input\-Port.\-h$>$}

Inheritance diagram for Picto\-:\-:Input\-Port\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=1.536351cm]{class_picto_1_1_input_port}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_picto_1_1_input_port_ae49fa1de9c84fe7e836b7e4377395c85}{add\-Input\-Channel} (int channel\-Num, int ms\-Per\-Sample)
\begin{DoxyCompactList}\small\item\em Adds a new input channel to this \hyperlink{class_picto_1_1_input_port}{Input\-Port} that is to be sampled at the input number of ms\-Per\-Sample. \end{DoxyCompactList}\item 
void \hyperlink{class_picto_1_1_input_port_a38b518f5abf207187207da782e32302b}{enable} (bool en)
\item 
void \hyperlink{class_picto_1_1_input_port_aa0230b63e579442362a33b7aa0a6b3a1}{update\-Data\-Buffer} (double curr\-Timestamp)
\begin{DoxyCompactList}\small\item\em Calls the empty \hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer()} function to load data from the D\-A\-Q into channel\-Buffers\-\_\-, then aligns timestamps in case of an imperfect D\-A\-Q clock. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a09c3cd9769baa2edc9591796bc52232f}{bool \hyperlink{class_picto_1_1_input_port_a09c3cd9769baa2edc9591796bc52232f}{has\-New\-Data} (int channel\-Num)}\label{class_picto_1_1_input_port_a09c3cd9769baa2edc9591796bc52232f}

\begin{DoxyCompactList}\small\item\em Returns true if there is new data available on this \hyperlink{class_picto_1_1_input_port}{Input\-Port}. \end{DoxyCompactList}\item 
Q\-Vector$<$ double $>$ \hyperlink{class_picto_1_1_input_port_a02a8fb8f8ef139a6387898ec5fa0fab7}{get\-Data} (int channel\-Num)
\begin{DoxyCompactList}\small\item\em Returns a vector of data samples for the input channel number. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a4f084ee011ca2a5298f6a088f56ed6b7}{double \hyperlink{class_picto_1_1_input_port_a4f084ee011ca2a5298f6a088f56ed6b7}{get\-Frame\-To\-Sample\-Offset} (int channel\-Num)}\label{class_picto_1_1_input_port_a4f084ee011ca2a5298f6a088f56ed6b7}

\begin{DoxyCompactList}\small\item\em Returns the offset from the time that the previous frame occured to the time that the first sample on the input channel was read. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a59767d320f491e862c400052c6dc6657}{virtual Q\-String \hyperlink{class_picto_1_1_input_port_a59767d320f491e862c400052c6dc6657}{type} ()}\label{class_picto_1_1_input_port_a59767d320f491e862c400052c6dc6657}

\begin{DoxyCompactList}\small\item\em Returns a string with the name of this type of \hyperlink{class_picto_1_1_input_port}{Input\-Port}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{class_picto_1_1_input_port_aefd4ff8fcdb966e2d39c47d244ed6925}{virtual bool \hyperlink{class_picto_1_1_input_port_aefd4ff8fcdb966e2d39c47d244ed6925}{start\-Sampling} ()=0}\label{class_picto_1_1_input_port_aefd4ff8fcdb966e2d39c47d244ed6925}

\begin{DoxyCompactList}\small\item\em Starts sampling of the D\-A\-Q hardware. Returns false if sampling can't be started. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a0980bd23dd8c524d3e30394539b5850f}{virtual void \hyperlink{class_picto_1_1_input_port_a0980bd23dd8c524d3e30394539b5850f}{stop\-Sampling} ()=0}\label{class_picto_1_1_input_port_a0980bd23dd8c524d3e30394539b5850f}

\begin{DoxyCompactList}\small\item\em Stops sampling of the D\-A\-Q hardware. Returns false if sampling can't be stopped. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{virtual double \hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer} ()=0}\label{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}

\begin{DoxyCompactList}\small\item\em Loads channel\-Buffers\-\_\- with data, returns the precise time when the data was actually read. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{class_picto_1_1_input_port_ab903e1969d02f8ec9f7644b302b224c1}{double \hyperlink{class_picto_1_1_input_port_ab903e1969d02f8ec9f7644b302b224c1}{device\-Samp\-Rate\-\_\-}}\label{class_picto_1_1_input_port_ab903e1969d02f8ec9f7644b302b224c1}

\begin{DoxyCompactList}\small\item\em This is the rate at which the Daq device will be sampled. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_af7fd054102d952d0c77724715be1b686}{Q\-Vector$<$ int $>$ \hyperlink{class_picto_1_1_input_port_af7fd054102d952d0c77724715be1b686}{channel\-Nums\-\_\-}}\label{class_picto_1_1_input_port_af7fd054102d952d0c77724715be1b686}

\begin{DoxyCompactList}\small\item\em A vector containing the channels to be sampled by the Daq device. \end{DoxyCompactList}\item 
\hypertarget{class_picto_1_1_input_port_a09aff384b2a6d499f824a1cbb9f7746a}{Q\-Hash$<$ int, Q\-Vector$<$ double $>$ $>$ \hyperlink{class_picto_1_1_input_port_a09aff384b2a6d499f824a1cbb9f7746a}{channel\-Buffers\-\_\-}}\label{class_picto_1_1_input_port_a09aff384b2a6d499f824a1cbb9f7746a}

\begin{DoxyCompactList}\small\item\em A hash of data buffers indexed by channel number to be filled by the child class. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Used to collect data from a single port that may handle multiple signals. 

Since in many cases different input lines on a single D\-A\-Q device port cannot be configured to be sampled at different sample rates, this class handles finding a sample rate that is high enough that it can be used to provide the desired sample rate for all desired input channels, and then down sampling the resultant data to provide data at those desired sample rates. Another common issue with D\-A\-Q devices is that their clocks are fairly innaccurate (apparently this is the trade off for being able to set whatever sample rate you want). These inaccurate sample clocks can create significant timing errors over the even a few seconds. This class handles synchronization of the D\-A\-Q sample clock and the \hyperlink{namespace_picto}{Picto} clock. It does this by comparing the calculated time of the incoming data assuming a perfect D\-A\-Q clock and comparing it to the time which the data was read according to the \hyperlink{namespace_picto}{Picto} clock. If the calculated clock dictates that the last data sample was read significantly before the time read on the \hyperlink{namespace_picto}{Picto} clock, data points are duplicated. If on the other hand, the calculated clock dictates that the last data point was read significantly after the time reported by the \hyperlink{namespace_picto}{Picto} clock, data points at the end are deleted. To keep from deleting significant information, we always sample the D\-A\-Q at 4 times the maximum necessary rate, so that we never need to throw out more than a quarter of a single sample period. This means that data reported by this class will always have been read within a quarter sample period of when it says it was such that we will be working within the set margin of error.

Child classes should handle the actual setup of the underlying device and implement the class's virtual functions. \begin{DoxyAuthor}{Author}
Joey Schnurr, Mark Hammond, Matt Gay 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2009-\/2013 
\end{DoxyDate}


Definition at line 34 of file Input\-Port.\-h.



\subsection{Member Function Documentation}
\hypertarget{class_picto_1_1_input_port_ae49fa1de9c84fe7e836b7e4377395c85}{\index{Picto\-::\-Input\-Port@{Picto\-::\-Input\-Port}!add\-Input\-Channel@{add\-Input\-Channel}}
\index{add\-Input\-Channel@{add\-Input\-Channel}!Picto::InputPort@{Picto\-::\-Input\-Port}}
\subsubsection[{add\-Input\-Channel}]{\setlength{\rightskip}{0pt plus 5cm}void Input\-Port\-::add\-Input\-Channel (
\begin{DoxyParamCaption}
\item[{int}]{channel\-Num, }
\item[{int}]{ms\-Per\-Sample}
\end{DoxyParamCaption}
)}}\label{class_picto_1_1_input_port_ae49fa1de9c84fe7e836b7e4377395c85}


Adds a new input channel to this \hyperlink{class_picto_1_1_input_port}{Input\-Port} that is to be sampled at the input number of ms\-Per\-Sample. 

Since the synchronization algorithm used by this \hyperlink{class_picto_1_1_input_port}{Input\-Port} requires that we sample at 4 times the fastest sample rate, we take the Greatest Common Devisor of all channels' sample periods, devide it by 4 and sample at that sample period. 

Definition at line 38 of file Input\-Port.\-cpp.

\hypertarget{class_picto_1_1_input_port_a38b518f5abf207187207da782e32302b}{\index{Picto\-::\-Input\-Port@{Picto\-::\-Input\-Port}!enable@{enable}}
\index{enable@{enable}!Picto::InputPort@{Picto\-::\-Input\-Port}}
\subsubsection[{enable}]{\setlength{\rightskip}{0pt plus 5cm}void Input\-Port\-::enable (
\begin{DoxyParamCaption}
\item[{bool}]{en}
\end{DoxyParamCaption}
)}}\label{class_picto_1_1_input_port_a38b518f5abf207187207da782e32302b}
The port starts sampling data as soon as the first \hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer()} is called if the port is enabled. disabling the port means that the port will start sampling from scratch the next time it is reenabled and \hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer()} is called. 

Definition at line 103 of file Input\-Port.\-cpp.

\hypertarget{class_picto_1_1_input_port_a02a8fb8f8ef139a6387898ec5fa0fab7}{\index{Picto\-::\-Input\-Port@{Picto\-::\-Input\-Port}!get\-Data@{get\-Data}}
\index{get\-Data@{get\-Data}!Picto::InputPort@{Picto\-::\-Input\-Port}}
\subsubsection[{get\-Data}]{\setlength{\rightskip}{0pt plus 5cm}Q\-Vector$<$ double $>$ Input\-Port\-::get\-Data (
\begin{DoxyParamCaption}
\item[{int}]{channel\-Num}
\end{DoxyParamCaption}
)}}\label{class_picto_1_1_input_port_a02a8fb8f8ef139a6387898ec5fa0fab7}


Returns a vector of data samples for the input channel number. 

\begin{DoxyNote}{Note}
A side effect of this function is that it clears out the data buffer for the input channel\-Num. 
\end{DoxyNote}


Definition at line 246 of file Input\-Port.\-cpp.

\hypertarget{class_picto_1_1_input_port_aa0230b63e579442362a33b7aa0a6b3a1}{\index{Picto\-::\-Input\-Port@{Picto\-::\-Input\-Port}!update\-Data\-Buffer@{update\-Data\-Buffer}}
\index{update\-Data\-Buffer@{update\-Data\-Buffer}!Picto::InputPort@{Picto\-::\-Input\-Port}}
\subsubsection[{update\-Data\-Buffer}]{\setlength{\rightskip}{0pt plus 5cm}void Input\-Port\-::update\-Data\-Buffer (
\begin{DoxyParamCaption}
\item[{double}]{curr\-Timestamp}
\end{DoxyParamCaption}
)}}\label{class_picto_1_1_input_port_aa0230b63e579442362a33b7aa0a6b3a1}


Calls the empty \hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer()} function to load data from the D\-A\-Q into channel\-Buffers\-\_\-, then aligns timestamps in case of an imperfect D\-A\-Q clock. 

When this function loads data, it reads the time at which the data was actually read and calculates the time that the last data point came in assuming that each sample was read at exactly the time dictaded by a perfect clock for the set sample period. If the calculated time is significantly lower than the actual time, a data point is duplicated to make up for it. If the calculated time is significantly higher than the actual time, a data point is deleted to make up for it. This function takes care of all of these issues.

The input curr\-Timestamp is the last time for which data should be returned for the current frame. Since there may have been some lag since the latest frame was displayed until this function was called, there may be some data points here that were read after the frame was over. When we read this data though, we only want data that came in up to the time that the frame was presented. This allows us to store data that came in too late for next frame and prepare only the data that occured during the previous frame. \begin{DoxyNote}{Note}
\hyperlink{class_picto_1_1_input_port_a885502b8712d339b918ac0c6ba418957}{update\-Data\-Buffer()} doesn't do anything unless all input channel data has been read since the last call to this function. 
\end{DoxyNote}


Definition at line 133 of file Input\-Port.\-cpp.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
source/common/engine/Input\-Port.\-h\item 
source/common/engine/Input\-Port.\-cpp\end{DoxyCompactItemize}
