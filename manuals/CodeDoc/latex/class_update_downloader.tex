\hypertarget{class_update_downloader}{\section{Update\-Downloader Class Reference}
\label{class_update_downloader}\index{Update\-Downloader@{Update\-Downloader}}
}


A singleton class used to check for and automatically update to a newer version of the \hyperlink{namespace_picto}{Picto} Application.  




{\ttfamily \#include $<$Update\-Downloader.\-h$>$}

Inheritance diagram for Update\-Downloader\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_update_downloader}
\end{center}
\end{figure}
\subsection*{Signals}
\begin{DoxyCompactItemize}
\item 
\hypertarget{class_update_downloader_a2978bbfa5db48034ada16f1378a6dcc9}{void {\bfseries update\-Failed} ()}\label{class_update_downloader_a2978bbfa5db48034ada16f1378a6dcc9}

\item 
\hypertarget{class_update_downloader_a5f5178d9d8bdbd41f5486dfaeff63fc7}{void {\bfseries closing\-Process} ()}\label{class_update_downloader_a5f5178d9d8bdbd41f5486dfaeff63fc7}

\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_update_downloader_ad6e908ee6f2d0d4628eed54e25f54785}{set\-Root\-Widget} (Q\-Widget $\ast$root)
\begin{DoxyCompactList}\small\item\em Use this to set the root widget of this application. \end{DoxyCompactList}\item 
void \hyperlink{class_update_downloader_af8d0a5cbab8130f584e769d962fa2e66}{require\-User\-Interaction} (bool en)
\begin{DoxyCompactList}\small\item\em If set true, the user will be required to press a button after an error message comes up. If user interaction is disabled, error messages will timeout automatically after M\-E\-S\-S\-A\-G\-E\-B\-O\-X\-D\-E\-L\-E\-Y\-S\-E\-C. \end{DoxyCompactList}\item 
void \hyperlink{class_update_downloader_a29c0bc0761f8db9bf15b50872efe8180}{enable\-Update\-Warning} (bool en)
\begin{DoxyCompactList}\small\item\em Use this enable an update warning allowing the user to disable the automatic update before it happens. \end{DoxyCompactList}\item 
bool \hyperlink{class_update_downloader_ae085db8c029b141c6a21b85c6f10e46b}{update} (Q\-String server\-Address, quint16 port)
\begin{DoxyCompactList}\small\item\em Call this to update this application to the latest code available on the server. \end{DoxyCompactList}\item 
void \hyperlink{class_update_downloader_a01415b46808853162ac985874dbe252e}{set\-Restart\-Commands} (Q\-String exe\-Path, Q\-String\-List args)
\begin{DoxyCompactList}\small\item\em Sets the commands needed to restart this application. \end{DoxyCompactList}\item 
void \hyperlink{class_update_downloader_ace2c5d929e9802a3b72da92941058cd7}{auto\-Check\-For\-Updates} (int freq\-Sec)
\begin{DoxyCompactList}\small\item\em Use this function to set up automatic checking for updates in an application that wouldn't normally be connecting to the server all the time anyway (ie. The workstation when not operating in \hyperlink{class_remote_viewer}{Remote\-Viewer} mode). \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{class_update_downloader_aba23de83959a7e9aea32fd2d5bb7b72e}{static Q\-Shared\-Pointer\\*
$<$ \hyperlink{class_update_downloader}{Update\-Downloader} $>$ \hyperlink{class_update_downloader_aba23de83959a7e9aea32fd2d5bb7b72e}{get\-Instance} ()}\label{class_update_downloader_aba23de83959a7e9aea32fd2d5bb7b72e}

\begin{DoxyCompactList}\small\item\em Returns a singleton instance of an \hyperlink{class_update_downloader}{Update\-Downloader}. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
A singleton class used to check for and automatically update to a newer version of the \hyperlink{namespace_picto}{Picto} Application. 

Currently, we put all \hyperlink{namespace_picto}{Picto} application files into all \hyperlink{namespace_picto}{Picto} installation directories regardless of which of the \hyperlink{namespace_picto}{Picto} applications will actually be run on a particular computer. This means that the Picto\-Server has a copy of all \hyperlink{namespace_picto}{Picto} Application files needed by all \hyperlink{namespace_picto}{Picto} computers. Whenever the Picto\-Server sends a message, it reports its current \hyperlink{namespace_picto}{Picto} Version. If the client sees that its version is lower than the server's version, it can request newer versions of the application files by using this class' object. The server keeps a cached copy of the zipped files and sends them over the network to the object. The object then goes through some fancy footwork to carefully upgrade the application in a reversible way. It first puts all of the new files into the application directory with .new suffixes appended to their names. It then tries to rename all of the other files in the application directory and add .old to their names. If this all works correctly, the indication is that there should be no problem renaming all the .new files by removing their .new suffixes. If that works, the application starts a new application process and ends the current one, thereby completing the update. If anything about the update fails, the application rolls all of the application files back to their previous condition. Since all files with .old or .new suffixes are always deleted at the beginning of the update process (before files are even downloaded) we don't have to worry about corruption from old files.

This object also makes heavy use of Timed\-Message\-Box widgets so that Automatic updating can occur on \hyperlink{class_director}{Director} and Proxy installations with zero user input, completely automatically.

The class is fairly stand alone. You pretty much just need to add it to every application, call a few setup functions like \hyperlink{class_update_downloader_ad6e908ee6f2d0d4628eed54e25f54785}{set\-Root\-Widget()}, and possibly \hyperlink{class_update_downloader_af8d0a5cbab8130f584e769d962fa2e66}{require\-User\-Interaction()}, \hyperlink{class_update_downloader_a29c0bc0761f8db9bf15b50872efe8180}{enable\-Update\-Warning()} and/or \hyperlink{class_update_downloader_ace2c5d929e9802a3b72da92941058cd7}{auto\-Check\-For\-Updates()} depending on the particular application use case and let the object do the rest.

\begin{DoxyAuthor}{Author}
Joey Schnurr, Mark Hammond, Matt Gay 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2009-\/2013 
\end{DoxyDate}


Definition at line 54 of file Update\-Downloader.\-h.



\subsection{Member Function Documentation}
\hypertarget{class_update_downloader_ace2c5d929e9802a3b72da92941058cd7}{\index{Update\-Downloader@{Update\-Downloader}!auto\-Check\-For\-Updates@{auto\-Check\-For\-Updates}}
\index{auto\-Check\-For\-Updates@{auto\-Check\-For\-Updates}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{auto\-Check\-For\-Updates}]{\setlength{\rightskip}{0pt plus 5cm}void Update\-Downloader\-::auto\-Check\-For\-Updates (
\begin{DoxyParamCaption}
\item[{int}]{freq\-Sec}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_ace2c5d929e9802a3b72da92941058cd7}


Use this function to set up automatic checking for updates in an application that wouldn't normally be connecting to the server all the time anyway (ie. The workstation when not operating in \hyperlink{class_remote_viewer}{Remote\-Viewer} mode). 

\begin{DoxyNote}{Note}
Client applications that use Command\-Channel\-::read\-Incoming\-Response() trigger an autoupdate automatically due to some code in that function. 
\end{DoxyNote}


Definition at line 173 of file Update\-Downloader.\-cpp.

\hypertarget{class_update_downloader_a29c0bc0761f8db9bf15b50872efe8180}{\index{Update\-Downloader@{Update\-Downloader}!enable\-Update\-Warning@{enable\-Update\-Warning}}
\index{enable\-Update\-Warning@{enable\-Update\-Warning}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{enable\-Update\-Warning}]{\setlength{\rightskip}{0pt plus 5cm}void Update\-Downloader\-::enable\-Update\-Warning (
\begin{DoxyParamCaption}
\item[{bool}]{en}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_a29c0bc0761f8db9bf15b50872efe8180}


Use this enable an update warning allowing the user to disable the automatic update before it happens. 

\begin{DoxyNote}{Note}
By default, the update warning is disabled. 
\end{DoxyNote}


Definition at line 53 of file Update\-Downloader.\-cpp.

\hypertarget{class_update_downloader_af8d0a5cbab8130f584e769d962fa2e66}{\index{Update\-Downloader@{Update\-Downloader}!require\-User\-Interaction@{require\-User\-Interaction}}
\index{require\-User\-Interaction@{require\-User\-Interaction}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{require\-User\-Interaction}]{\setlength{\rightskip}{0pt plus 5cm}void Update\-Downloader\-::require\-User\-Interaction (
\begin{DoxyParamCaption}
\item[{bool}]{en}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_af8d0a5cbab8130f584e769d962fa2e66}


If set true, the user will be required to press a button after an error message comes up. If user interaction is disabled, error messages will timeout automatically after M\-E\-S\-S\-A\-G\-E\-B\-O\-X\-D\-E\-L\-E\-Y\-S\-E\-C. 

\begin{DoxyNote}{Note}
By default, the user interaction is disabled. 
\end{DoxyNote}


Definition at line 62 of file Update\-Downloader.\-cpp.

\hypertarget{class_update_downloader_a01415b46808853162ac985874dbe252e}{\index{Update\-Downloader@{Update\-Downloader}!set\-Restart\-Commands@{set\-Restart\-Commands}}
\index{set\-Restart\-Commands@{set\-Restart\-Commands}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{set\-Restart\-Commands}]{\setlength{\rightskip}{0pt plus 5cm}void Update\-Downloader\-::set\-Restart\-Commands (
\begin{DoxyParamCaption}
\item[{Q\-String}]{exe\-Path, }
\item[{Q\-String\-List}]{args}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_a01415b46808853162ac985874dbe252e}


Sets the commands needed to restart this application. 


\begin{DoxyParams}{Parameters}
{\em exe\-Path} & The path to the running executable. \\
\hline
{\em args} & The list of arguments to use with the executable.\\
\hline
\end{DoxyParams}
If the application update is successfull, the application is restarted automatically. This tells the update\-Downloader what commands need to be used to perform the restart. 

Definition at line 162 of file Update\-Downloader.\-cpp.

\hypertarget{class_update_downloader_ad6e908ee6f2d0d4628eed54e25f54785}{\index{Update\-Downloader@{Update\-Downloader}!set\-Root\-Widget@{set\-Root\-Widget}}
\index{set\-Root\-Widget@{set\-Root\-Widget}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{set\-Root\-Widget}]{\setlength{\rightskip}{0pt plus 5cm}void Update\-Downloader\-::set\-Root\-Widget (
\begin{DoxyParamCaption}
\item[{Q\-Widget $\ast$}]{root}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_ad6e908ee6f2d0d4628eed54e25f54785}


Use this to set the root widget of this application. 

This is used as part of the process of closing the application when it needs to be restarted automatically after an update. 

Definition at line 44 of file Update\-Downloader.\-cpp.

\hypertarget{class_update_downloader_ae085db8c029b141c6a21b85c6f10e46b}{\index{Update\-Downloader@{Update\-Downloader}!update@{update}}
\index{update@{update}!UpdateDownloader@{Update\-Downloader}}
\subsubsection[{update}]{\setlength{\rightskip}{0pt plus 5cm}bool Update\-Downloader\-::update (
\begin{DoxyParamCaption}
\item[{Q\-String}]{server\-Address, }
\item[{quint16}]{port}
\end{DoxyParamCaption}
)}}\label{class_update_downloader_ae085db8c029b141c6a21b85c6f10e46b}


Call this to update this application to the latest code available on the server. 


\begin{DoxyParams}{Parameters}
{\em server\-Address} & The I\-P address of the \hyperlink{namespace_picto}{Picto} \hyperlink{class_server}{Server}. \\
\hline
{\em port} & The port on which to request the new \hyperlink{namespace_picto}{Picto} files.\\
\hline
\end{DoxyParams}
This function starts out by requesting user permission to perform the update if necessary, it then goes through the following procedure\-:
\begin{DoxyItemize}
\item Deletes all files in the \hyperlink{namespace_picto}{Picto} directory with \char`\"{}.\-new\char`\"{} or \char`\"{}.\-old\char`\"{} suffixes. (delete\-Old\-Files())
\item Downloads all files from the server, unzips them and saves them with added \char`\"{}.\-new\char`\"{} suffixes in the application directory (get\-Files())
\item Append \char`\"{}.\-old\char`\"{} suffixes to everything in the application directory that isn't \char`\"{}.\-new\char`\"{}, removes all \char`\"{}.\-new\char`\"{} suffixes, starts a new instance of the application in a new process and exits the current application process. (update\-Apps())
\end{DoxyItemize}

If any of the above steps fails, an appropriate error message is displayed, and any changes that would make the current installation corrupt (ie. if the \char`\"{}.\-old\char`\"{} suffixes were appended to the current application files) are fixed. 

Definition at line 118 of file Update\-Downloader.\-cpp.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
source/common/update/Update\-Downloader.\-h\item 
source/common/update/Update\-Downloader.\-cpp\end{DoxyCompactItemize}
