\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller}{\section{Picto\-:\-:Picto\-Box\-X\-P\-Reward\-Controller Class Reference}
\label{class_picto_1_1_picto_box_x_p_reward_controller}\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
}


A reward controller for the Picto\-Box.  




{\ttfamily \#include $<$Picto\-Box\-X\-P\-Reward\-Controller.\-h$>$}

Inheritance diagram for Picto\-:\-:Picto\-Box\-X\-P\-Reward\-Controller\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_picto_1_1_picto_box_x_p_reward_controller}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_ab2f7e7619d810f7e365beaedb1b01029}{Picto\-Box\-X\-P\-Reward\-Controller} ()
\begin{DoxyCompactList}\small\item\em Constructs a \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller}{Picto\-Box\-X\-P\-Reward\-Controller} object. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{start\-Reward} (unsigned int channel, int quantity)
\begin{DoxyCompactList}\small\item\em Implements \hyperlink{class_picto_1_1_reward_controller_a3e09bdba141632e89472bef42dc1e132}{Reward\-Controller\-::start\-Reward()} to output a correctly timed reward signal on the output line. \end{DoxyCompactList}\item 
virtual bool \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a3f06b94221e0bec202b4e3236e20429b}{reward\-Was\-Supplied} (unsigned int channel)
\begin{DoxyCompactList}\small\item\em Implements \hyperlink{class_picto_1_1_reward_controller_a213ce91b8ef9019786e96e601d9641b9}{Reward\-Controller\-::reward\-Was\-Supplied()} to return true when the latest reward to have been started using \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{start\-Reward()} is complete. \end{DoxyCompactList}\item 
virtual void \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a5dc6d881ee582daaf7eae64be6f8af1e}{start\-Flush} (unsigned int channel)
\begin{DoxyCompactList}\small\item\em Implements \hyperlink{class_picto_1_1_reward_controller_aaf880507edaa44288cd5b17bdb71f079}{Reward\-Controller\-::start\-Flush()} to raise the reward line voltage. \end{DoxyCompactList}\item 
virtual void \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_ae9567626896a597b6cda39acd1b0aaf5}{stop\-Flush} (unsigned int channel)
\begin{DoxyCompactList}\small\item\em Implements \hyperlink{class_picto_1_1_reward_controller_a5a14b4f103def1711b485cc05f4c53bb}{Reward\-Controller\-::stop\-Flush()} to lower the reward line voltage. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
A reward controller for the Picto\-Box. 

Picto\-Box uses a National Instruments P\-C\-I-\/6221 data acquisition board to deliver rewards (the same board is used for the 8 analog inputs, 8 digital outputs and event code outputs). As long as Picto\-Box is running Windows X\-P-\/$>$Windows 7, we can use the traditional N\-I\-D\-A\-Q M\-X drivers.

The original concept for handling reward controller connections was to simply use the first four lines of port 0 (ie. P0.\-0-\/\-P0.\-3) for to control the relays that handle the reward outputs. The problem with this was that we wanted to be able to use timers to turn off the pins for precise reward delivery timing. We are theoretically supposed to be able to configure the nidaq card so that digital lines can use clocks from other parts of the card, but I have not yet figured out how to do this correctly. Instead, currently we only support one reward controller where the reward trigger line is the analog output A0.\-0. We are using A0.\-1 as the line that enables the relays, so with the current setup we can't use more than one reward line. The reason for using A0.\-1 as a reward enable line is that if we simply connect reward enable to 5\-V, then when the Pictobox is restarted, 5\-V is on the reward enable line, but the A0.\-0 line defaults to 0\-V on startup. Since the Crouznet P\-B-\/4 Digital I/\-O board containing our realays uses active low logic to enable the relays, we would therefore end up basically flushing on the reward controller every time we restarted \hyperlink{namespace_picto}{Picto}, which would be a bad thing. If we ever need to support multiple reward lines, someone will either have to spend a lot more time than I had working through the Ni\-Daq documentation and experimenting, or, more likely, we will need to purchase an updated Ni\-Daq card that has individual clocks available for 4 output lines.

\begin{DoxyNote}{Note}
The Crouzet P\-B-\/4 Digital I/\-O board uses active low logic to activate the reward relays. 
\end{DoxyNote}
\begin{DoxyAuthor}{Author}
Joey Schnurr, Mark Hammond, Matt Gay 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2009-\/2013 
\end{DoxyDate}


Definition at line 36 of file Picto\-Box\-X\-P\-Reward\-Controller.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller_ab2f7e7619d810f7e365beaedb1b01029}{\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}!Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-Box\-X\-P\-Reward\-Controller}}
\index{Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-Box\-X\-P\-Reward\-Controller}!Picto::PictoBoxXPRewardController@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
\subsubsection[{Picto\-Box\-X\-P\-Reward\-Controller}]{\setlength{\rightskip}{0pt plus 5cm}Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller\-::\-Picto\-Box\-X\-P\-Reward\-Controller (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{class_picto_1_1_picto_box_x_p_reward_controller_ab2f7e7619d810f7e365beaedb1b01029}


Constructs a \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller}{Picto\-Box\-X\-P\-Reward\-Controller} object. 

Creates a \char`\"{}\-Reward\-Task\char`\"{} and \char`\"{}\-Reward\-Enable\-Task\char`\"{} to set both the reward line and the reward enable line to high voltages when \hyperlink{namespace_picto}{Picto} starts. Since the \hyperlink{class_picto_1_1_reward}{Reward} relay card uses active low logic, we need to start the reward line high. Incidentally, this is why we cant simply attach the relay card's enable line to 5 volts. Since all output lines start low when the Pictobox turns on, but the 5\-V line starts high if we connected the relay card's enable line to 5\-V, the reward solenoid would always be open after the computer restarted until \hyperlink{namespace_picto}{Picto} started. 

Definition at line 45 of file Picto\-Box\-X\-P\-Reward\-Controller.\-cpp.



\subsection{Member Function Documentation}
\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller_a3f06b94221e0bec202b4e3236e20429b}{\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}!reward\-Was\-Supplied@{reward\-Was\-Supplied}}
\index{reward\-Was\-Supplied@{reward\-Was\-Supplied}!Picto::PictoBoxXPRewardController@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
\subsubsection[{reward\-Was\-Supplied}]{\setlength{\rightskip}{0pt plus 5cm}bool Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller\-::reward\-Was\-Supplied (
\begin{DoxyParamCaption}
\item[{unsigned int}]{channel}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{class_picto_1_1_picto_box_x_p_reward_controller_a3f06b94221e0bec202b4e3236e20429b}


Implements \hyperlink{class_picto_1_1_reward_controller_a213ce91b8ef9019786e96e601d9641b9}{Reward\-Controller\-::reward\-Was\-Supplied()} to return true when the latest reward to have been started using \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{start\-Reward()} is complete. 

In the case of the \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller}{Picto\-Box\-X\-P\-Reward\-Controller}, we piggyback onto this function and actually stop the reward task once the reward has been completely supplied. See \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{start\-Reward()} for more details. 

Implements \hyperlink{class_picto_1_1_reward_controller_a213ce91b8ef9019786e96e601d9641b9}{Picto\-::\-Reward\-Controller}.



Definition at line 154 of file Picto\-Box\-X\-P\-Reward\-Controller.\-cpp.

\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller_a5dc6d881ee582daaf7eae64be6f8af1e}{\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}!start\-Flush@{start\-Flush}}
\index{start\-Flush@{start\-Flush}!Picto::PictoBoxXPRewardController@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
\subsubsection[{start\-Flush}]{\setlength{\rightskip}{0pt plus 5cm}void Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller\-::start\-Flush (
\begin{DoxyParamCaption}
\item[{unsigned int}]{channel}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{class_picto_1_1_picto_box_x_p_reward_controller_a5dc6d881ee582daaf7eae64be6f8af1e}


Implements \hyperlink{class_picto_1_1_reward_controller_aaf880507edaa44288cd5b17bdb71f079}{Reward\-Controller\-::start\-Flush()} to raise the reward line voltage. 

Unlike in \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{start\-Reward()} flushes are not stopped automatically. The \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_ae9567626896a597b6cda39acd1b0aaf5}{stop\-Flush()} function is used to lower the reward line. 

Implements \hyperlink{class_picto_1_1_reward_controller_aaf880507edaa44288cd5b17bdb71f079}{Picto\-::\-Reward\-Controller}.



Definition at line 174 of file Picto\-Box\-X\-P\-Reward\-Controller.\-cpp.

\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}{\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}!start\-Reward@{start\-Reward}}
\index{start\-Reward@{start\-Reward}!Picto::PictoBoxXPRewardController@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
\subsubsection[{start\-Reward}]{\setlength{\rightskip}{0pt plus 5cm}void Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller\-::start\-Reward (
\begin{DoxyParamCaption}
\item[{unsigned int}]{channel, }
\item[{int}]{quantity}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{class_picto_1_1_picto_box_x_p_reward_controller_a8490db56a1df896a33362aeea7c0cafc}


Implements \hyperlink{class_picto_1_1_reward_controller_a3e09bdba141632e89472bef42dc1e132}{Reward\-Controller\-::start\-Reward()} to output a correctly timed reward signal on the output line. 

As far as timing goes, the Ni\-Daq card only supports periodic timing signals. We have not found a way to define a simple high-\/low pulse. For this reason, we set up a clock pulse that ticks once for each \char`\"{}quantity\char`\"{} milliseconds. We then attach this clock to a task that sends the output signal high, low, high, low, switching once per clock pulse. The reward signal then goes high for exactly as long as we want and then low. Since the reward system is updated once per frame, we are assured that \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a3f06b94221e0bec202b4e3236e20429b}{reward\-Was\-Supplied()} will be called once per frame. \hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a3f06b94221e0bec202b4e3236e20429b}{reward\-Was\-Supplied()} stops the task once the required reward quantity has been supplied, so the second high pulse never happens.

\begin{DoxyNote}{Note}
The downside to this is that we can't provide rewards of under 16ms, in practice, rewards this small are very non-\/linear and not a good idea anyway. 
\end{DoxyNote}


Implements \hyperlink{class_picto_1_1_reward_controller_a3e09bdba141632e89472bef42dc1e132}{Picto\-::\-Reward\-Controller}.



Definition at line 113 of file Picto\-Box\-X\-P\-Reward\-Controller.\-cpp.

\hypertarget{class_picto_1_1_picto_box_x_p_reward_controller_ae9567626896a597b6cda39acd1b0aaf5}{\index{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}!stop\-Flush@{stop\-Flush}}
\index{stop\-Flush@{stop\-Flush}!Picto::PictoBoxXPRewardController@{Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller}}
\subsubsection[{stop\-Flush}]{\setlength{\rightskip}{0pt plus 5cm}void Picto\-::\-Picto\-Box\-X\-P\-Reward\-Controller\-::stop\-Flush (
\begin{DoxyParamCaption}
\item[{unsigned int}]{channel}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{class_picto_1_1_picto_box_x_p_reward_controller_ae9567626896a597b6cda39acd1b0aaf5}


Implements \hyperlink{class_picto_1_1_reward_controller_a5a14b4f103def1711b485cc05f4c53bb}{Reward\-Controller\-::stop\-Flush()} to lower the reward line voltage. 

\begin{DoxySeeAlso}{See Also}
\hyperlink{class_picto_1_1_picto_box_x_p_reward_controller_a5dc6d881ee582daaf7eae64be6f8af1e}{start\-Flush()} 
\end{DoxySeeAlso}


Implements \hyperlink{class_picto_1_1_reward_controller_a5a14b4f103def1711b485cc05f4c53bb}{Picto\-::\-Reward\-Controller}.



Definition at line 205 of file Picto\-Box\-X\-P\-Reward\-Controller.\-cpp.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
source/director/iodevices/Picto\-Box\-X\-P\-Reward\-Controller.\-h\item 
source/director/iodevices/Picto\-Box\-X\-P\-Reward\-Controller.\-cpp\end{DoxyCompactItemize}
