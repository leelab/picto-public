<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Picto: source/server/connections/ConnectionManager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="pictodoc.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Picto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="dir_25f19b0ae85c078e0a95db0b0e9a410f.html">server</a></li><li class="navelem"><a class="el" href="dir_8bf4a35853be504bcc4a071fa035c3bf.html">connections</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ConnectionManager.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;ConnectionManager.h&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;ServerConfig.h&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;QXmlStreamWriter&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;QMutexLocker&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;QDateTime&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;QDir&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;QCoreApplication&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;QSqlQuery&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;QApplication&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;QTimer&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;QtConcurrentRun&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;ServerConfig.h&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;../../common/memleakdetect.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#define DROPPED_SESSION_TIMEOUT_DAYS 1</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor"></span><a class="code" href="class_connection_manager.html">ConnectionManager</a>* ConnectionManager::conMan_ = 0;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;ConnectionManager::ConnectionManager()</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    timeoutTimer_ = <span class="keyword">new</span> QTimer;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    timeoutTimer_-&gt;setInterval(5000);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    connect(timeoutTimer_, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(checkForTimeouts()));</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    timeoutTimer_-&gt;start();</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    mutex_ = <span class="keyword">new</span> QMutex(QMutex::Recursive);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aa4061f5b6a3cb842f3ecce80d776db0d">   42</a></span>&#160;<a class="code" href="class_connection_manager.html">ConnectionManager</a>* <a class="code" href="class_connection_manager.html#aa4061f5b6a3cb842f3ecce80d776db0d">ConnectionManager::Instance</a>()</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span>(!conMan_)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        conMan_ = <span class="keyword">new</span> <a class="code" href="class_connection_manager.html">ConnectionManager</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> conMan_;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;ConnectionManager::~ConnectionManager()</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">delete</span> timeoutTimer_;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">delete</span> mutex_;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">//This should probably also set conMan_ to NULL.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keywordtype">void</span> ConnectionManager::checkForTimeouts()</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">foreach</span>(QSharedPointer&lt;SessionInfo&gt; sessionInfo, openSessions_)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span>(!sessionInfo-&gt;clearActivity())</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">// Check if anything is still active in this session.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            sessionInfo-&gt;UpdateComponentActivity();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">if</span>(sessionInfo-&gt;hasActiveComponents())</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                <span class="comment">//Some components may still be running this session.  Time it out, but keep it available.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                sessionInfo-&gt;flushCache();</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                serverConfig.<a class="code" href="class_server_config.html#a5169a1d3ba39ad1f64998d6d1a9eb3a1">setActivity</a>(sessionInfo-&gt;uuid_.toString(),<span class="keyword">false</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                openSessions_.remove(sessionInfo-&gt;uuid_);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                printf(<span class="stringliteral">&quot;Session timed out!!!!!\n&quot;</span>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="comment">//Since endSession may take a long time and we don&#39;t want to create thread safety issues.  Whenever we end</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="comment">//a session, we just unlock the mutex first and leave the function when we&#39;re done.  The other sessions will</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="comment">//miss one round of timeout checking.  But that doesn&#39;t make any significant difference.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                locker.unlock();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <a class="code" href="class_connection_manager.html#ad70ceceadb24b53fc7bf9c04526dcbf5">endSession</a>(sessionInfo-&gt;sessionId());</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            QSharedPointer&lt;ComponentInfo&gt; component = sessionInfo-&gt;getComponentByType(<span class="stringliteral">&quot;DIRECTOR&quot;</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span>(!component.isNull())</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                component-&gt;setActivity();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="comment">//sessionInfo-&gt;enableFlush(&quot;DIRECTOR&quot;);</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            component = sessionInfo-&gt;getComponentByType(<span class="stringliteral">&quot;PROXY&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">if</span>(!component.isNull())</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                component-&gt;setActivity();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <span class="comment">//sessionInfo-&gt;enableFlush(&quot;PROXY&quot;);</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="comment">//sessionInfo-&gt;flushCache();</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            QFuture&lt;bool&gt; future = QtConcurrent::run(sessionInfo.data(),&amp;<a class="code" href="class_session_info.html#af4106254bbe6282aae6e79e3b92ece2b">SessionInfo::flushCache</a>,QString(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">//Now check for component timeouts.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">foreach</span>(QSharedPointer&lt;ComponentInfo&gt; componentInfo, components_)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span>(!componentInfo-&gt;clearActivity())</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            componentInfo-&gt;setStatus(ComponentStatus::notFound);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            components_.remove(componentInfo-&gt;getUuid());</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            printf(componentInfo-&gt;getType().append(<span class="stringliteral">&quot;timed out!!!!!!!\n&quot;</span>).toLatin1());</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="class_connection_manager.html#ab4d8f848dd065a478a6123f8d400c712">  143</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_connection_manager.html#ab4d8f848dd065a478a6123f8d400c712">ConnectionManager::updateComponent</a>(QUuid uuid, QHostAddress addr, QUuid sessionId, QString name, QString type, ComponentStatus::ComponentStatus status, QString details)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    QSharedPointer&lt;ComponentInfo&gt; info;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span>(components_.contains(uuid))</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        info = components_[uuid];</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// Maybe its running from a session that was dropped.  The call below will check and add that session back to the ilst if necessary.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        QSharedPointer&lt;SessionInfo&gt; sessInfo = <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">getSessionInfo</a>(sessionId);   </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">if</span>(!sessInfo.isNull())</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            info = sessInfo-&gt;getComponentByType(type);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="comment">//If there&#39;s any session that thinks this component is attached to it, it&#39;s not anymore.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="comment">//Load that session and associate this component with it, so that it can see that this</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment">//component has moved on.  That way, when it times out, if its other components have also</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="comment">//moved on, it will know that it has to end.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            sessInfo = <a class="code" href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">getSessionInfoByComponent</a>(uuid);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">if</span>(!sessInfo.isNull())</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                info = sessInfo-&gt;getComponentByType(type);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                <span class="comment">//Create a new component.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                info = QSharedPointer&lt;ComponentInfo&gt;(<span class="keyword">new</span> <a class="code" href="class_component_info.html">ComponentInfo</a>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        info-&gt;setUuid(uuid);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        info-&gt;setAddress(addr.toString());</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        components_[uuid] = info;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    info-&gt;setName(name);    </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    info-&gt;setStatus(status);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span>(!details.isEmpty())</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        info-&gt;setDetails(details);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    info-&gt;setType(type);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    info-&gt;setSessionID(sessionId);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    info-&gt;setActivity();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    QSharedPointer&lt;SessionInfo&gt; sessInfo = <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">getSessionInfo</a>(sessionId);   </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span>(!sessInfo.isNull())</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        sessInfo-&gt;setActivity();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aad3eaf716a61bdfb93caaf68eb46cf14">  213</a></span>&#160;QString <a class="code" href="class_connection_manager.html#aad3eaf716a61bdfb93caaf68eb46cf14">ConnectionManager::getProxyList</a>()</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;{</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    QString xmlFragment;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    QXmlStreamWriter xmlWriter(&amp;xmlFragment);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    xmlWriter.writeStartElement(<span class="stringliteral">&quot;ProxyInstances&quot;</span>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">foreach</span>(QSharedPointer&lt;ComponentInfo&gt; component, components_)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span>(component-&gt;getType() != <span class="stringliteral">&quot;PROXY&quot;</span>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        xmlWriter.writeStartElement(<span class="stringliteral">&quot;Proxy&quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Address&quot;</span>,component-&gt;getAddress());</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Id&quot;</span>,component-&gt;getUuid().toString());</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Name&quot;</span>, component-&gt;getName());</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::idle)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Idle&quot;</span>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::ending)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Ending&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::stopped)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Stopped&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::paused)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Paused&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::running)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Running&quot;</span>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;NotFound&quot;</span>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        xmlWriter.writeEndElement(); <span class="comment">//Proxy</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    xmlWriter.writeEndElement();    <span class="comment">//ProxyInstances</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> xmlFragment;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aa5d9b89543c27e9640f3544150a0f31b">  270</a></span>&#160;QString <a class="code" href="class_connection_manager.html#aa5d9b89543c27e9640f3544150a0f31b">ConnectionManager::getDirectorList</a>()</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    QString xmlFragment;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    QXmlStreamWriter xmlWriter(&amp;xmlFragment);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    xmlWriter.writeStartElement(<span class="stringliteral">&quot;DirectorInstances&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">foreach</span>(QSharedPointer&lt;ComponentInfo&gt; component, components_)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">if</span>(component-&gt;getType() != <span class="stringliteral">&quot;DIRECTOR&quot;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        xmlWriter.writeStartElement(<span class="stringliteral">&quot;Director&quot;</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Address&quot;</span>,component-&gt;getAddress());</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Id&quot;</span>,component-&gt;getUuid().toString());</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Name&quot;</span>, component-&gt;getName());</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::idle)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Idle&quot;</span>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::ending)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Ending&quot;</span>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::stopped)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Stopped&quot;</span>);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::paused)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Paused&quot;</span>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(component-&gt;getStatus() == ComponentStatus::running)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;Running&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            xmlWriter.writeTextElement(<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;NotFound&quot;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Session-ID&quot;</span>,component-&gt;getSessionID().toString());</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        xmlWriter.writeTextElement(<span class="stringliteral">&quot;Details&quot;</span>,component-&gt;getDetails());</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        xmlWriter.writeEndElement(); <span class="comment">//Director</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    xmlWriter.writeEndElement();    <span class="comment">//DirectorInstances</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">return</span> xmlFragment;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="class_connection_manager.html#ab21f514f743abe71fe4d7aaa0c598ccc">  310</a></span>&#160;ComponentStatus::ComponentStatus <a class="code" href="class_connection_manager.html#ab21f514f743abe71fe4d7aaa0c598ccc">ConnectionManager::getComponentStatus</a>(QUuid uuid)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;{</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span>(components_.contains(uuid))</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">//checking the status is a form of activity</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        components_[uuid]-&gt;setActivity();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">return</span> components_[uuid]-&gt;getStatus();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> ComponentStatus::notFound;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a12b04c4bb99b3def7483695123317d34">  326</a></span>&#160;ComponentStatus::ComponentStatus <a class="code" href="class_connection_manager.html#ab21f514f743abe71fe4d7aaa0c598ccc">ConnectionManager::getComponentStatus</a>(QString uuidStr)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    QUuid uuid(uuidStr);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_connection_manager.html#ab21f514f743abe71fe4d7aaa0c598ccc">getComponentStatus</a>(uuid);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a6009f2afd5adfd7dc30611866bca1171">  335</a></span>&#160;ComponentStatus::ComponentStatus <a class="code" href="class_connection_manager.html#a6009f2afd5adfd7dc30611866bca1171">ConnectionManager::getComponentStatusBySession</a>(QUuid sessionId, QString componentType)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;{</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(sessionId.toString()))</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        QSharedPointer&lt;SessionInfo&gt; sessInfo = openSessions_.value(sessionId);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        QSharedPointer&lt;ComponentInfo&gt; component = sessInfo-&gt;getComponentByType(componentType);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">if</span>(!component.isNull())</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keywordflow">return</span> component-&gt;getStatus();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">return</span> ComponentStatus::notFound;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a8622ab351976620118e4effc54522291">  353</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_connection_manager.html#a8622ab351976620118e4effc54522291">ConnectionManager::setComponentStatus</a>(QUuid sessionId, QString componentType, ComponentStatus::ComponentStatus status)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(sessionId.toString()))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        QSharedPointer&lt;SessionInfo&gt; sessInfo = openSessions_.value(sessionId);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        QSharedPointer&lt;ComponentInfo&gt; component = sessInfo-&gt;getComponentByType(componentType);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">if</span>(!component.isNull())</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            component-&gt;setActivity();</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            component-&gt;setStatus(status);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a05d82ba38c7e11e4a23bcd5749713e2f">  378</a></span>&#160;QUuid <a class="code" href="class_connection_manager.html#a05d82ba38c7e11e4a23bcd5749713e2f">ConnectionManager::GetComponentsSessionId</a>(QUuid componentId)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span>(components_.contains(componentId))</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">//checking the components SessionID is a form of activity</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        components_[componentId]-&gt;setActivity();</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">return</span> components_[componentId]-&gt;getSessionID();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">return</span> QUuid();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a99e60a314f4bce6953499ba2375fcd14">  399</a></span>&#160;QUuid <a class="code" href="class_connection_manager.html#a05d82ba38c7e11e4a23bcd5749713e2f">ConnectionManager::GetComponentsSessionId</a>(QString componentId)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_connection_manager.html#a05d82ba38c7e11e4a23bcd5749713e2f">GetComponentsSessionId</a>(QUuid(componentId));</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a3248768ab6c18c6cceed2a024924dd1e">  409</a></span>&#160;QSharedPointer&lt;SessionInfo&gt; <a class="code" href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">ConnectionManager::getSessionInfoByComponent</a>(QUuid componentID)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;{</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">//Iterate through the open sessions looking for the session info with the </span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="comment">//matching component ID</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">foreach</span>(QSharedPointer&lt;SessionInfo&gt; session, openSessions_)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span>(session-&gt;hasComponent(componentID))</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">getSessionInfo</a>(session-&gt;uuid_);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">//Maybe this component was in a dropped session.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    QString sessionID = serverConfig.<a class="code" href="class_server_config.html#a868a40ae84ee613f8cc464a74216163a">getSessionPathByComponent</a>(componentID.toString());</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(sessionID))<span class="comment">//This will load the session for us</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">getSessionInfo</a>(sessionID);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">return</span> QSharedPointer&lt;SessionInfo&gt;(); <span class="comment">// If we got here then it doesn&#39;t exist</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">  435</a></span>&#160;QSharedPointer&lt;SessionInfo&gt; <a class="code" href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">ConnectionManager::getSessionInfoByComponent</a>(QString componentID)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    QUuid uuid(componentID);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">getSessionInfoByComponent</a>(uuid);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">  444</a></span>&#160;QSharedPointer&lt;SessionInfo&gt; <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">ConnectionManager::getSessionInfo</a>(QUuid uuid)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(uuid.toString()))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">return</span> openSessions_[uuid];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">return</span> QSharedPointer&lt;SessionInfo&gt;();</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aab7005e98b0721aa376e3ad37e96bd7f">  465</a></span>&#160;QUuid <a class="code" href="class_connection_manager.html#aab7005e98b0721aa376e3ad37e96bd7f">ConnectionManager::pendingSession</a>(QUuid componentID)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;{</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">if</span>(pendingSessions_.contains(componentID))</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        QUuid sessionId = pendingSessions_[componentID];</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        pendingSessions_.remove(componentID);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">return</span> sessionId;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">return</span> QUuid();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno"><a class="line" href="class_connection_manager.html#aa0e821de2a8b6578a121ba64e999b7e5">  492</a></span>&#160;QSharedPointer&lt;SessionInfo&gt; <a class="code" href="class_connection_manager.html#aa0e821de2a8b6578a121ba64e999b7e5">ConnectionManager::createSession</a>(QUuid directorID, QUuid proxyID, QString designName, QByteArray designXml, QByteArray DesignConfig, QUuid initialObserverId, QString password)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;{</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span>(!components_.contains(directorID))</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">return</span> QSharedPointer&lt;SessionInfo&gt;();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span>((proxyID != QUuid()) &amp;&amp; !components_.contains(proxyID))</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">return</span> QSharedPointer&lt;SessionInfo&gt;();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">#ifndef DEVELOPMENTBUILD</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(password.isEmpty())</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">return</span> QSharedPointer&lt;SessionInfo&gt;();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    QString directorName = components_[directorID]-&gt;getName();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    QSharedPointer&lt;SessionInfo&gt; sessInfo(<a class="code" href="class_session_info.html#ab22e776e9d2e6047d8759a8e2d884fa4">SessionInfo::CreateSession</a>(designName, directorName, designXml,DesignConfig,initialObserverId, password));</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    sessInfo-&gt;AddComponent(components_[directorID]);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span>(proxyID != QUuid())</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        sessInfo-&gt;AddComponent(components_[proxyID]);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        sessInfo-&gt;alignTimestampsTo(components_[directorID]-&gt;getType());</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    pendingSessions_[directorID] = sessInfo-&gt;uuid_;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span>(proxyID != QUuid())</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        pendingSessions_[proxyID] = sessInfo-&gt;uuid_;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    openSessions_[sessInfo-&gt;uuid_] = sessInfo;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">//Add session data to serverConfig database</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    serverConfig.<a class="code" href="class_server_config.html#abb3cc44cbd2fca32dd9914bb481ba708">addSession</a>(sessInfo-&gt;sessionId().toString(),sessInfo-&gt;dataBaseFilePath(),</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        directorID.toString(),proxyID.toString());</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">//Whenever we create a new session, we check for timeouts of previously dropped sessions.</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    checkForDroppedSessionTimeouts();</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">return</span> sessInfo;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;}</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a86811fb45f5dc933975acecf6bf7788a">  535</a></span>&#160;QSharedPointer&lt;SessionInfo&gt; <a class="code" href="class_connection_manager.html#a86811fb45f5dc933975acecf6bf7788a">ConnectionManager::loadSession</a>(QString sessionId, QString filePath)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;{</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    QSharedPointer&lt;SessionInfo&gt; sessInfo;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">//Check if the file exists in the file path.  If not it was deleted and we should not </span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">//attempt to load the session because weird things will happen.  In that case we simply</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">//remove it from the ServerConfig database</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span>(!QFile::exists(filePath))</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        serverConfig.<a class="code" href="class_server_config.html#ab61785553877dc52c09a72df32178963">removeSession</a>(sessionId);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">return</span> sessInfo;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    sessInfo = <a class="code" href="class_session_info.html#a1f3c535a8c90e32cc0ec38caf2d0f42c">SessionInfo::LoadSession</a>(sessionId,filePath);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span>(!sessInfo)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">return</span> sessInfo;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    openSessions_[sessInfo-&gt;uuid_] = sessInfo;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> sessInfo;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordtype">void</span> ConnectionManager::checkForDroppedSessionTimeouts()</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;{</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="class_server_config.html">ServerConfig</a> config;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    QStringList runningSessions = config.<a class="code" href="class_server_config.html#a35c54a2cbfd98f53105ee36d4176663e">getRunningSessions</a>();</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">foreach</span>(QString session, runningSessions)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">if</span>(!openSessions_.contains(QUuid(session)))</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        {<span class="comment">// It says its open but its not, there must have been a server crash.  Set it to idle.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            config.<a class="code" href="class_server_config.html#a5169a1d3ba39ad1f64998d6d1a9eb3a1">setActivity</a>(session,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    QDateTime timeoutTime = QDateTime::currentDateTime().addDays(-DROPPED_SESSION_TIMEOUT_DAYS);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    QStringList timedOut = config.<a class="code" href="class_server_config.html#a99f5a212ba07712ad3e7f109c4c0325b">getSessionsIdledBefore</a>(timeoutTime);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">foreach</span>(QString session, timedOut)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(session)) <span class="comment">//This will load the session for us.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="comment">//This tells the session to report that its components are no longer active.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="comment">//That means that it will be ended as soon as it times out.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <a class="code" href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">getSessionInfo</a>(QUuid(session))-&gt;ignoreComponents();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">  588</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">ConnectionManager::sessionIsValid</a>(QString sessionId)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;{</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">if</span>((sessionId == <span class="stringliteral">&quot;&quot;</span>) || (QUuid(sessionId) == QUuid()))</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span>(openSessions_.contains(sessionId))</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">// Maybe it was a dropped session.  Check serverConfig.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    QString sessionPath = serverConfig.<a class="code" href="class_server_config.html#a2b374738ea1e49524707831e9a3e9eb5">getSessionPathByID</a>(sessionId);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span>(sessionPath != <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        locker.unlock();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        QSharedPointer&lt;SessionInfo&gt; sessInfo = <a class="code" href="class_connection_manager.html#a86811fb45f5dc933975acecf6bf7788a">loadSession</a>(sessionId,sessionPath);      </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span>(!sessInfo.isNull())</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;}</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="class_connection_manager.html#ad70ceceadb24b53fc7bf9c04526dcbf5">  612</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_connection_manager.html#ad70ceceadb24b53fc7bf9c04526dcbf5">ConnectionManager::endSession</a>(QUuid sessionId)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;{</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">sessionIsValid</a>(sessionId.toString()) &amp;&amp; openSessions_[sessionId]-&gt;<a class="code" href="class_connection_manager.html#ad70ceceadb24b53fc7bf9c04526dcbf5">endSession</a>())</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        QMutexLocker locker(mutex_);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        openSessions_.remove(sessionId);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="class_server_config.html">ServerConfig</a> serverConfig;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        serverConfig.<a class="code" href="class_server_config.html#ab61785553877dc52c09a72df32178963">removeSession</a>(sessionId.toString());</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;}</div>
<div class="ttc" id="class_session_info_html_af4106254bbe6282aae6e79e3b92ece2b"><div class="ttname"><a href="class_session_info.html#af4106254bbe6282aae6e79e3b92ece2b">SessionInfo::flushCache</a></div><div class="ttdeci">bool flushCache(QString sourceType=&quot;&quot;)</div><div class="ttdoc">Dumps the RAM cached data into the file based Session database. </div><div class="ttdef"><b>Definition:</b> <a href="_session_info_8cpp_source.html#l00538">SessionInfo.cpp:538</a></div></div>
<div class="ttc" id="class_connection_manager_html_ab21f514f743abe71fe4d7aaa0c598ccc"><div class="ttname"><a href="class_connection_manager.html#ab21f514f743abe71fe4d7aaa0c598ccc">ConnectionManager::getComponentStatus</a></div><div class="ttdeci">ComponentStatus::ComponentStatus getComponentStatus(QUuid uuid)</div><div class="ttdoc">Returns the status of the component instance with the passed in Unique User ID. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00310">ConnectionManager.cpp:310</a></div></div>
<div class="ttc" id="class_server_config_html_ab61785553877dc52c09a72df32178963"><div class="ttname"><a href="class_server_config.html#ab61785553877dc52c09a72df32178963">ServerConfig::removeSession</a></div><div class="ttdeci">void removeSession(QString sessionID)</div><div class="ttdoc">Removes the session with the input ID from the config database. </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00088">ServerConfig.cpp:88</a></div></div>
<div class="ttc" id="class_connection_manager_html_a6a6e5a39b29a164c12b72dfe33a767e9"><div class="ttname"><a href="class_connection_manager.html#a6a6e5a39b29a164c12b72dfe33a767e9">ConnectionManager::sessionIsValid</a></div><div class="ttdeci">bool sessionIsValid(QString sessionId)</div><div class="ttdoc">Returns true if a session with the input sessionId is open or previously timed out on this Server...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00588">ConnectionManager.cpp:588</a></div></div>
<div class="ttc" id="class_connection_manager_html_ab4d8f848dd065a478a6123f8d400c712"><div class="ttname"><a href="class_connection_manager.html#ab4d8f848dd065a478a6123f8d400c712">ConnectionManager::updateComponent</a></div><div class="ttdeci">void updateComponent(QUuid uuid, QHostAddress addr, QUuid sessionId, QString name, QString type, ComponentStatus::ComponentStatus status, QString details)</div><div class="ttdoc">Updates the list of connected Components with the input Component information. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00143">ConnectionManager.cpp:143</a></div></div>
<div class="ttc" id="class_connection_manager_html_aa0e821de2a8b6578a121ba64e999b7e5"><div class="ttname"><a href="class_connection_manager.html#aa0e821de2a8b6578a121ba64e999b7e5">ConnectionManager::createSession</a></div><div class="ttdeci">QSharedPointer&lt; SessionInfo &gt; createSession(QUuid directorID, QUuid proxyID, QString designName, QByteArray designXml, QByteArray DesignConfig, QUuid initialObserverId, QString password)</div><div class="ttdoc">Creates a new session and returns a pointer to the SessionInfo object. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00492">ConnectionManager.cpp:492</a></div></div>
<div class="ttc" id="class_connection_manager_html_aa4061f5b6a3cb842f3ecce80d776db0d"><div class="ttname"><a href="class_connection_manager.html#aa4061f5b6a3cb842f3ecce80d776db0d">ConnectionManager::Instance</a></div><div class="ttdeci">static ConnectionManager * Instance()</div><div class="ttdoc">Returns the ConnectionManager instance. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00042">ConnectionManager.cpp:42</a></div></div>
<div class="ttc" id="class_connection_manager_html_a05d82ba38c7e11e4a23bcd5749713e2f"><div class="ttname"><a href="class_connection_manager.html#a05d82ba38c7e11e4a23bcd5749713e2f">ConnectionManager::GetComponentsSessionId</a></div><div class="ttdeci">QUuid GetComponentsSessionId(QUuid componentId)</div><div class="ttdoc">Returns the sessionID associated with the input ComponentID. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00378">ConnectionManager.cpp:378</a></div></div>
<div class="ttc" id="class_connection_manager_html_aa5d9b89543c27e9640f3544150a0f31b"><div class="ttname"><a href="class_connection_manager.html#aa5d9b89543c27e9640f3544150a0f31b">ConnectionManager::getDirectorList</a></div><div class="ttdeci">QString getDirectorList()</div><div class="ttdoc">Returns a list of director instances as an xml fragment. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00270">ConnectionManager.cpp:270</a></div></div>
<div class="ttc" id="class_server_config_html_a99f5a212ba07712ad3e7f109c4c0325b"><div class="ttname"><a href="class_server_config.html#a99f5a212ba07712ad3e7f109c4c0325b">ServerConfig::getSessionsIdledBefore</a></div><div class="ttdeci">QStringList getSessionsIdledBefore(QDateTime time)</div><div class="ttdoc">Returns a list of all sessions with &amp;quot;running&amp;quot; field of false and lastactivity time before the input t...</div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00196">ServerConfig.cpp:196</a></div></div>
<div class="ttc" id="class_server_config_html_abb3cc44cbd2fca32dd9914bb481ba708"><div class="ttname"><a href="class_server_config.html#abb3cc44cbd2fca32dd9914bb481ba708">ServerConfig::addSession</a></div><div class="ttdeci">void addSession(QString sessionID, QString filepath, QString directorID, QString proxyID)</div><div class="ttdoc">Inserts a session into the open sessions list. Stored data includes the Session&amp;#39;s ID...</div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00068">ServerConfig.cpp:68</a></div></div>
<div class="ttc" id="class_server_config_html_a868a40ae84ee613f8cc464a74216163a"><div class="ttname"><a href="class_server_config.html#a868a40ae84ee613f8cc464a74216163a">ServerConfig::getSessionPathByComponent</a></div><div class="ttdeci">QString getSessionPathByComponent(QString componentID)</div><div class="ttdoc">Returns the filepath of the database for the Session associated with the input component. </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00121">ServerConfig.cpp:121</a></div></div>
<div class="ttc" id="class_connection_manager_html_ad70ceceadb24b53fc7bf9c04526dcbf5"><div class="ttname"><a href="class_connection_manager.html#ad70ceceadb24b53fc7bf9c04526dcbf5">ConnectionManager::endSession</a></div><div class="ttdeci">bool endSession(QUuid sessionId)</div><div class="ttdoc">Ends a currently running session. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00612">ConnectionManager.cpp:612</a></div></div>
<div class="ttc" id="class_server_config_html_a5169a1d3ba39ad1f64998d6d1a9eb3a1"><div class="ttname"><a href="class_server_config.html#a5169a1d3ba39ad1f64998d6d1a9eb3a1">ServerConfig::setActivity</a></div><div class="ttdeci">void setActivity(QString sessionID, bool running)</div><div class="ttdoc">Sets the lastactivity field for the input session to the current time and changes the running field t...</div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00161">ServerConfig.cpp:161</a></div></div>
<div class="ttc" id="class_server_config_html_a35c54a2cbfd98f53105ee36d4176663e"><div class="ttname"><a href="class_server_config.html#a35c54a2cbfd98f53105ee36d4176663e">ServerConfig::getRunningSessions</a></div><div class="ttdeci">QStringList getRunningSessions()</div><div class="ttdoc">Returns a list of all sessions with &amp;quot;running&amp;quot; field of true (ie. They have not timed out)...</div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00179">ServerConfig.cpp:179</a></div></div>
<div class="ttc" id="class_connection_manager_html_a6608548da05a185b1e7a4a3361974766"><div class="ttname"><a href="class_connection_manager.html#a6608548da05a185b1e7a4a3361974766">ConnectionManager::getSessionInfo</a></div><div class="ttdeci">QSharedPointer&lt; SessionInfo &gt; getSessionInfo(QUuid uuid)</div><div class="ttdoc">Returns the session info for the open session with the passed in session id. If no such session is op...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00444">ConnectionManager.cpp:444</a></div></div>
<div class="ttc" id="class_connection_manager_html_a8622ab351976620118e4effc54522291"><div class="ttname"><a href="class_connection_manager.html#a8622ab351976620118e4effc54522291">ConnectionManager::setComponentStatus</a></div><div class="ttdeci">void setComponentStatus(QUuid sessionId, QString componentType, ComponentStatus::ComponentStatus status)</div><div class="ttdoc">Sets the component status for the component instance of the input type that is running in the session...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00353">ConnectionManager.cpp:353</a></div></div>
<div class="ttc" id="class_connection_manager_html_aab7005e98b0721aa376e3ad37e96bd7f"><div class="ttname"><a href="class_connection_manager.html#aab7005e98b0721aa376e3ad37e96bd7f">ConnectionManager::pendingSession</a></div><div class="ttdeci">QUuid pendingSession(QUuid componentID)</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00465">ConnectionManager.cpp:465</a></div></div>
<div class="ttc" id="class_session_info_html_a1f3c535a8c90e32cc0ec38caf2d0f42c"><div class="ttname"><a href="class_session_info.html#a1f3c535a8c90e32cc0ec38caf2d0f42c">SessionInfo::LoadSession</a></div><div class="ttdeci">static QSharedPointer&lt; SessionInfo &gt; LoadSession(QString sessionID, QString databaseFilePath)</div><div class="ttdoc">Loads the Session with the input sessionId and the Sqlite Session file at the input databaseFilePath ...</div><div class="ttdef"><b>Definition:</b> <a href="_session_info_8cpp_source.html#l00059">SessionInfo.cpp:59</a></div></div>
<div class="ttc" id="class_connection_manager_html_aff1c3942e20523922e9ef264bce83c77"><div class="ttname"><a href="class_connection_manager.html#aff1c3942e20523922e9ef264bce83c77">ConnectionManager::getSessionInfoByComponent</a></div><div class="ttdeci">QSharedPointer&lt; SessionInfo &gt; getSessionInfoByComponent(QString componentID)</div><div class="ttdoc">Returns the session info for the session attached to the component with the input component ID string...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00435">ConnectionManager.cpp:435</a></div></div>
<div class="ttc" id="class_component_info_html"><div class="ttname"><a href="class_component_info.html">ComponentInfo</a></div><div class="ttdoc">Contains information about a ComponentInterface (ie. Director or Proxy) that is connected to the Pict...</div><div class="ttdef"><b>Definition:</b> <a href="_component_info_8h_source.html#l00027">ComponentInfo.h:27</a></div></div>
<div class="ttc" id="class_connection_manager_html"><div class="ttname"><a href="class_connection_manager.html">ConnectionManager</a></div><div class="ttdoc">Keeps track of all active Components (Director/Proxy) as well as all active and recently timed out Se...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8h_source.html#l00030">ConnectionManager.h:30</a></div></div>
<div class="ttc" id="class_connection_manager_html_aad3eaf716a61bdfb93caaf68eb46cf14"><div class="ttname"><a href="class_connection_manager.html#aad3eaf716a61bdfb93caaf68eb46cf14">ConnectionManager::getProxyList</a></div><div class="ttdeci">QString getProxyList()</div><div class="ttdoc">Returns a list of proxy instances as an xml fragment. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00213">ConnectionManager.cpp:213</a></div></div>
<div class="ttc" id="class_session_info_html_ab22e776e9d2e6047d8759a8e2d884fa4"><div class="ttname"><a href="class_session_info.html#ab22e776e9d2e6047d8759a8e2d884fa4">SessionInfo::CreateSession</a></div><div class="ttdeci">static QSharedPointer&lt; SessionInfo &gt; CreateSession(QString designName, QString directorName, QByteArray designXml, QByteArray DesignConfig, QUuid initialObserverId, QString password)</div><div class="ttdoc">Creates a new SessionInfo object. </div><div class="ttdef"><b>Definition:</b> <a href="_session_info_8cpp_source.html#l00046">SessionInfo.cpp:46</a></div></div>
<div class="ttc" id="class_connection_manager_html_a6009f2afd5adfd7dc30611866bca1171"><div class="ttname"><a href="class_connection_manager.html#a6009f2afd5adfd7dc30611866bca1171">ConnectionManager::getComponentStatusBySession</a></div><div class="ttdeci">ComponentStatus::ComponentStatus getComponentStatusBySession(QUuid sessionId, QString componentType)</div><div class="ttdoc">Returns the status of the component instance with the passed in componentType that is part of the ses...</div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00335">ConnectionManager.cpp:335</a></div></div>
<div class="ttc" id="class_connection_manager_html_a86811fb45f5dc933975acecf6bf7788a"><div class="ttname"><a href="class_connection_manager.html#a86811fb45f5dc933975acecf6bf7788a">ConnectionManager::loadSession</a></div><div class="ttdeci">QSharedPointer&lt; SessionInfo &gt; loadSession(QString sessionId, QString filePath)</div><div class="ttdoc">Load&amp;#39;s a previously timed out Session with the input sessionId from the file at filePath. If the file does not exist, the session is removed from the input ServerConfig object. </div><div class="ttdef"><b>Definition:</b> <a href="_connection_manager_8cpp_source.html#l00535">ConnectionManager.cpp:535</a></div></div>
<div class="ttc" id="class_server_config_html"><div class="ttname"><a href="class_server_config.html">ServerConfig</a></div><div class="ttdoc">ServerConfig handles the configuration of a PictoServer. </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8h_source.html#l00026">ServerConfig.h:26</a></div></div>
<div class="ttc" id="class_server_config_html_a2b374738ea1e49524707831e9a3e9eb5"><div class="ttname"><a href="class_server_config.html#a2b374738ea1e49524707831e9a3e9eb5">ServerConfig::getSessionPathByID</a></div><div class="ttdeci">QString getSessionPathByID(QString sessionID)</div><div class="ttdoc">Returns the filepath of the database for the session with input ID. </div><div class="ttdef"><b>Definition:</b> <a href="_server_config_8cpp_source.html#l00102">ServerConfig.cpp:102</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jan 26 2014 17:03:38 for Picto by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
