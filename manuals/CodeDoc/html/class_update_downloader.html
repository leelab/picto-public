<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Picto: UpdateDownloader Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="pictodoc.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Picto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#signals">Signals</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="class_update_downloader-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">UpdateDownloader Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A singleton class used to check for and automatically update to a newer version of the Picto Application.  
 <a href="class_update_downloader.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_update_downloader_8h_source.html">UpdateDownloader.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for UpdateDownloader:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_update_downloader.png" usemap="#UpdateDownloader_map" alt=""/>
  <map id="UpdateDownloader_map" name="UpdateDownloader_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="signals"></a>
Signals</h2></td></tr>
<tr class="memitem:a2978bbfa5db48034ada16f1378a6dcc9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2978bbfa5db48034ada16f1378a6dcc9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>updateFailed</b> ()</td></tr>
<tr class="separator:a2978bbfa5db48034ada16f1378a6dcc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f5178d9d8bdbd41f5486dfaeff63fc7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5f5178d9d8bdbd41f5486dfaeff63fc7"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>closingProcess</b> ()</td></tr>
<tr class="separator:a5f5178d9d8bdbd41f5486dfaeff63fc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad6e908ee6f2d0d4628eed54e25f54785"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#ad6e908ee6f2d0d4628eed54e25f54785">setRootWidget</a> (QWidget *root)</td></tr>
<tr class="memdesc:ad6e908ee6f2d0d4628eed54e25f54785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use this to set the root widget of this application.  <a href="#ad6e908ee6f2d0d4628eed54e25f54785">More...</a><br /></td></tr>
<tr class="separator:ad6e908ee6f2d0d4628eed54e25f54785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8d0a5cbab8130f584e769d962fa2e66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#af8d0a5cbab8130f584e769d962fa2e66">requireUserInteraction</a> (bool en)</td></tr>
<tr class="memdesc:af8d0a5cbab8130f584e769d962fa2e66"><td class="mdescLeft">&#160;</td><td class="mdescRight">If set true, the user will be required to press a button after an error message comes up. If user interaction is disabled, error messages will timeout automatically after MESSAGEBOXDELEYSEC.  <a href="#af8d0a5cbab8130f584e769d962fa2e66">More...</a><br /></td></tr>
<tr class="separator:af8d0a5cbab8130f584e769d962fa2e66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29c0bc0761f8db9bf15b50872efe8180"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#a29c0bc0761f8db9bf15b50872efe8180">enableUpdateWarning</a> (bool en)</td></tr>
<tr class="memdesc:a29c0bc0761f8db9bf15b50872efe8180"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use this enable an update warning allowing the user to disable the automatic update before it happens.  <a href="#a29c0bc0761f8db9bf15b50872efe8180">More...</a><br /></td></tr>
<tr class="separator:a29c0bc0761f8db9bf15b50872efe8180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae085db8c029b141c6a21b85c6f10e46b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#ae085db8c029b141c6a21b85c6f10e46b">update</a> (QString serverAddress, quint16 port)</td></tr>
<tr class="memdesc:ae085db8c029b141c6a21b85c6f10e46b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this to update this application to the latest code available on the server.  <a href="#ae085db8c029b141c6a21b85c6f10e46b">More...</a><br /></td></tr>
<tr class="separator:ae085db8c029b141c6a21b85c6f10e46b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01415b46808853162ac985874dbe252e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#a01415b46808853162ac985874dbe252e">setRestartCommands</a> (QString exePath, QStringList args)</td></tr>
<tr class="memdesc:a01415b46808853162ac985874dbe252e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the commands needed to restart this application.  <a href="#a01415b46808853162ac985874dbe252e">More...</a><br /></td></tr>
<tr class="separator:a01415b46808853162ac985874dbe252e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace2c5d929e9802a3b72da92941058cd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#ace2c5d929e9802a3b72da92941058cd7">autoCheckForUpdates</a> (int freqSec)</td></tr>
<tr class="memdesc:ace2c5d929e9802a3b72da92941058cd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use this function to set up automatic checking for updates in an application that wouldn't normally be connecting to the server all the time anyway (ie. The workstation when not operating in <a class="el" href="class_remote_viewer.html" title="This allows Operators to view and control a remotely running Experimental Session. ">RemoteViewer</a> mode).  <a href="#ace2c5d929e9802a3b72da92941058cd7">More...</a><br /></td></tr>
<tr class="separator:ace2c5d929e9802a3b72da92941058cd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:aba23de83959a7e9aea32fd2d5bb7b72e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba23de83959a7e9aea32fd2d5bb7b72e"></a>
static QSharedPointer&lt; <a class="el" href="class_update_downloader.html">UpdateDownloader</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_update_downloader.html#aba23de83959a7e9aea32fd2d5bb7b72e">getInstance</a> ()</td></tr>
<tr class="memdesc:aba23de83959a7e9aea32fd2d5bb7b72e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a singleton instance of an <a class="el" href="class_update_downloader.html" title="A singleton class used to check for and automatically update to a newer version of the Picto Applicat...">UpdateDownloader</a>. <br /></td></tr>
<tr class="separator:aba23de83959a7e9aea32fd2d5bb7b72e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A singleton class used to check for and automatically update to a newer version of the Picto Application. </p>
<p>Currently, we put all Picto application files into all Picto installation directories regardless of which of the Picto applications will actually be run on a particular computer. This means that the PictoServer has a copy of all Picto Application files needed by all Picto computers. Whenever the PictoServer sends a message, it reports its current Picto Version. If the client sees that its version is lower than the server's version, it can request newer versions of the application files by using this class' object. The server keeps a cached copy of the zipped files and sends them over the network to the object. The object then goes through some fancy footwork to carefully upgrade the application in a reversible way. It first puts all of the new files into the application directory with .new suffixes appended to their names. It then tries to rename all of the other files in the application directory and add .old to their names. If this all works correctly, the indication is that there should be no problem renaming all the .new files by removing their .new suffixes. If that works, the application starts a new application process and ends the current one, thereby completing the update. If anything about the update fails, the application rolls all of the application files back to their previous condition. Since all files with .old or .new suffixes are always deleted at the beginning of the update process (before files are even downloaded) we don't have to worry about corruption from old files.</p>
<p>This object also makes heavy use of TimedMessageBox widgets so that Automatic updating can occur on <a class="el" href="class_director.html" title="Defines an object that runs a Picto Experiment for a test subject, transmits experimental data to the...">Director</a> and Proxy installations with zero user input, completely automatically.</p>
<p>The class is fairly stand alone. You pretty much just need to add it to every application, call a few setup functions like <a class="el" href="class_update_downloader.html#ad6e908ee6f2d0d4628eed54e25f54785" title="Use this to set the root widget of this application. ">setRootWidget()</a>, and possibly <a class="el" href="class_update_downloader.html#af8d0a5cbab8130f584e769d962fa2e66" title="If set true, the user will be required to press a button after an error message comes up...">requireUserInteraction()</a>, <a class="el" href="class_update_downloader.html#a29c0bc0761f8db9bf15b50872efe8180" title="Use this enable an update warning allowing the user to disable the automatic update before it happens...">enableUpdateWarning()</a> and/or <a class="el" href="class_update_downloader.html#ace2c5d929e9802a3b72da92941058cd7" title="Use this function to set up automatic checking for updates in an application that wouldn&#39;t normally b...">autoCheckForUpdates()</a> depending on the particular application use case and let the object do the rest.</p>
<dl class="section author"><dt>Author</dt><dd>Joey Schnurr, Mark Hammond, Matt Gay </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2009-2013 </dd></dl>

<p>Definition at line <a class="el" href="_update_downloader_8h_source.html#l00053">53</a> of file <a class="el" href="_update_downloader_8h_source.html">UpdateDownloader.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ace2c5d929e9802a3b72da92941058cd7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateDownloader::autoCheckForUpdates </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>freqSec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use this function to set up automatic checking for updates in an application that wouldn't normally be connecting to the server all the time anyway (ie. The workstation when not operating in <a class="el" href="class_remote_viewer.html" title="This allows Operators to view and control a remotely running Experimental Session. ">RemoteViewer</a> mode). </p>
<dl class="section note"><dt>Note</dt><dd>Client applications that use CommandChannel::readIncomingResponse() trigger an autoupdate automatically due to some code in that function. </dd></dl>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00173">173</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a29c0bc0761f8db9bf15b50872efe8180"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateDownloader::enableUpdateWarning </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>en</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use this enable an update warning allowing the user to disable the automatic update before it happens. </p>
<dl class="section note"><dt>Note</dt><dd>By default, the update warning is disabled. </dd></dl>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00053">53</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af8d0a5cbab8130f584e769d962fa2e66"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateDownloader::requireUserInteraction </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>en</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If set true, the user will be required to press a button after an error message comes up. If user interaction is disabled, error messages will timeout automatically after MESSAGEBOXDELEYSEC. </p>
<dl class="section note"><dt>Note</dt><dd>By default, the user interaction is disabled. </dd></dl>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00062">62</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a01415b46808853162ac985874dbe252e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateDownloader::setRestartCommands </td>
          <td>(</td>
          <td class="paramtype">QString&#160;</td>
          <td class="paramname"><em>exePath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QStringList&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the commands needed to restart this application. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exePath</td><td>The path to the running executable. </td></tr>
    <tr><td class="paramname">args</td><td>The list of arguments to use with the executable.</td></tr>
  </table>
  </dd>
</dl>
<p>If the application update is successfull, the application is restarted automatically. This tells the updateDownloader what commands need to be used to perform the restart. </p>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00162">162</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad6e908ee6f2d0d4628eed54e25f54785"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateDownloader::setRootWidget </td>
          <td>(</td>
          <td class="paramtype">QWidget *&#160;</td>
          <td class="paramname"><em>root</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use this to set the root widget of this application. </p>
<p>This is used as part of the process of closing the application when it needs to be restarted automatically after an update. </p>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00044">44</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae085db8c029b141c6a21b85c6f10e46b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool UpdateDownloader::update </td>
          <td>(</td>
          <td class="paramtype">QString&#160;</td>
          <td class="paramname"><em>serverAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">quint16&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this to update this application to the latest code available on the server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">serverAddress</td><td>The IP address of the Picto <a class="el" href="class_server.html" title="The Server object managing the actual incoming connections and ServerThread generation for the PictoS...">Server</a>. </td></tr>
    <tr><td class="paramname">port</td><td>The port on which to request the new Picto files.</td></tr>
  </table>
  </dd>
</dl>
<p>This function starts out by requesting user permission to perform the update if necessary, it then goes through the following procedure:</p><ul>
<li>Deletes all files in the Picto directory with ".new" or ".old" suffixes. (deleteOldFiles())</li>
<li>Downloads all files from the server, unzips them and saves them with added ".new" suffixes in the application directory (getFiles())</li>
<li>Append ".old" suffixes to everything in the application directory that isn't ".new", removes all ".new" suffixes, starts a new instance of the application in a new process and exits the current application process. (updateApps())</li>
</ul>
<p>If any of the above steps fails, an appropriate error message is displayed, and any changes that would make the current installation corrupt (ie. if the ".old" suffixes were appended to the current application files) are fixed. </p>

<p>Definition at line <a class="el" href="_update_downloader_8cpp_source.html#l00118">118</a> of file <a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>source/common/update/<a class="el" href="_update_downloader_8h_source.html">UpdateDownloader.h</a></li>
<li>source/common/update/<a class="el" href="_update_downloader_8cpp_source.html">UpdateDownloader.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
